---
import { getCollection } from 'astro:content';
const concepts = await getCollection('concepts');
const courses = await getCollection('courses');
const bySubject = concepts.reduce((acc, c) => {
  const s = c.data.subject;
  acc[s] ??= [];
  acc[s].push(c);
  return acc;
}, {} as Record<string, typeof concepts>);
for (const s in bySubject) {
  bySubject[s].sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999) || a.slug.localeCompare(b.slug));
}
const subjects = Object.keys(bySubject).sort();
---
<nav class="sticky top-20 space-y-8">
  <section>
    <h2 class="text-xs uppercase tracking-widest text-[color:var(--muted)] mb-2">Concepts</h2>
    <ul class="space-y-3">
      {subjects.map((s) => (
        <li>
          <div class="text-sm font-semibold mb-1 capitalize">{s.replace('-', ' ')}</div>
          <ul class="space-y-1">
            {bySubject[s].map((c) => (
              <li>
                <a href={`/concepts/${c.slug}`} class="text-sm hover:text-brand-300">{c.data.title}</a>
              </li>
            ))}
          </ul>
        </li>
      ))}
    </ul>
  </section>
  <section>
    <h2 class="text-xs uppercase tracking-widest text-[color:var(--muted)] mb-2">Courses</h2>
    <ul class="space-y-1">
      {courses.map((k) => (
        <li><a href={`/courses/${k.data.id}`} class="text-sm hover:text-brand-300">{k.data.title}</a></li>
      ))}
    </ul>
  </section>
</nav>
