---
import { getEntryBySlug } from 'astro:content';
import Docs from '../../layouts/DocsLayout.astro';
export async function getStaticPaths() {
  // Use glob to collect all concept slugs under content
  const modules = import.meta.glob('../../../content/concepts/**/*.{md,mdx}', { eager: true });
  return Object.keys(modules).map((path) => {
    // Convert e.g. concepts/mathematics/limits.mdx -> mathematics/limits
    const m = path.match(/concepts\/(.*)\.(md|mdx)$/);
    const slug = m ? m[1] : '';
    return { params: { slug: slug.split('/') } };
  });
}
const { slug } = Astro.params;
const joined = Array.isArray(slug) ? slug.join('/') : slug;
const entry = await getEntryBySlug('concepts', joined);
if (!entry) throw new Error(`Concept not found: ${joined}`);
const { Content, headings } = await entry.render();
const resolvedPrerequisites = await Promise.all(
  (entry.data.prerequisites ?? []).map(async (slug) => {
    const concept = await getEntryBySlug('concepts', slug);
    if (concept) {
      return {
        title: concept.data.title,
        href: `/concepts/${concept.slug}`
      };
    }

    const lesson = await getEntryBySlug('lessons', slug);
    if (lesson) {
      return {
        title: lesson.data.title,
        href: `/lessons/${lesson.slug}`
      };
    }

    return { title: slug };
  })
);
---
<Docs title={`${entry.data.title} â€” YourSite`}>
  <article class="prose prose-invert max-w-none">
    <h1 class="text-3xl font-bold mb-2">{entry.data.title}</h1>
    {entry.data.description && <p class="text-[color:var(--muted)] mb-6">{entry.data.description}</p>}
    {resolvedPrerequisites.length > 0 && (
      <section class="mb-8">
        <h2 class="text-xl font-semibold mb-3">Prerequisites</h2>
        <ul class="list-disc pl-5 space-y-1">
          {resolvedPrerequisites.map((item) => (
            <li>
              {item.href ? (
                <a href={item.href} class="text-sky-300 hover:underline">
                  {item.title}
                </a>
              ) : (
                <span>{item.title}</span>
              )}
            </li>
          ))}
        </ul>
      </section>
    )}
    <Content />
  </article>
</Docs>
