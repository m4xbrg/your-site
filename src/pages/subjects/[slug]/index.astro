---
import DocsLayout from "../../../layouts/DocsLayout.astro";
import { getCollection } from 'astro:content';
const { slug } = Astro.params;
const sortByOrder = (a, b) => (a.data.order ?? 0) - (b.data.order ?? 0);
const subject = (await getCollection('subjects')).find((entry) => entry.slug === slug);
if (!subject) {
  throw new Error(`Subject not found: ${slug}`);
}
const courses = (await getCollection('courses'))
  .filter((course) => course.data.subject === subject.slug)
  .sort(sortByOrder);
const concepts = (await getCollection('concepts'))
  .filter((concept) => concept.data.subject === subject.slug)
  .sort(sortByOrder);
---
<DocsLayout title={subject.data.title} description={subject.data.description}>
  <section>
    <h1 class="text-3xl font-bold mb-2">{subject.data.title}</h1>
    {subject.data.description && <p class="text-[color:var(--muted)] mb-6">{subject.data.description}</p>}
  </section>
  {courses.length > 0 && (
    <section class="mt-8">
      <h2 class="text-2xl font-semibold mb-3">Courses</h2>
      <ul class="list-disc ms-6 space-y-2">
        {courses.map((course) => (
          <li>
            <a class="text-brand-300 hover:underline" href={`/courses/${course.slug}/`}>
              {course.data.code} â€” {course.data.title}
            </a>
            {course.data.description && (
              <p class="text-sm text-[color:var(--muted)] mt-1">{course.data.description}</p>
            )}
          </li>
        ))}
      </ul>
    </section>
  )}
  {concepts.length > 0 && (
    <section class="mt-10">
      <h2 class="text-2xl font-semibold mb-3">Concepts</h2>
      <ul class="list-disc ms-6 space-y-2">
        {concepts.map((concept) => (
          <li>
            <a class="text-brand-300 hover:underline" href={`/concepts/${concept.slug}/`}>
              {concept.data.title}
            </a>
            {concept.data.summary && (
              <p class="text-sm text-[color:var(--muted)] mt-1">{concept.data.summary}</p>
            )}
          </li>
        ))}
      </ul>
    </section>
  )}
</DocsLayout>
