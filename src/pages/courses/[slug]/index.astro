---
import DocsLayout from "../../../layouts/DocsLayout.astro"
import { getCollection } from 'astro:content'

const sortByOrder = (a,b) => (a.data.order ?? 0) - (b.data.order ?? 0)

export async function getStaticPaths() {
  const [courses, concepts] = await Promise.all([
    getCollection('courses'),
    getCollection('concepts'),
  ])

  return courses.map((course) => ({
    params: { slug: course.slug },
    props: {
      course,
      concepts: concepts
        .filter((concept) => concept.data.course === course.slug)
        .slice()
        .sort(sortByOrder),
    },
  }))
}

const { course, concepts } = Astro.props
if (!course) throw new Error('Course not found')
---
<DocsLayout title={course.data.title} description={course.data.description}>
  <h1 class="text-2xl font-bold mb-2">{course.data.code} â€” {course.data.title}</h1>
  {course.data.description && <p class="text-gray-700 mb-6">{course.data.description}</p>}
  <h2 class="text-lg font-semibold mt-8 mb-3">Concepts in this course</h2>
  <ul class="list-disc ms-5">
    {concepts.map(k => <li><a class="underline" href={`/concepts/${k.slug}/`}>{k.data.title}</a></li>)}
  </ul>
</DocsLayout>
